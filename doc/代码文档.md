# DIY导航网页 - 代码文档

## 系统架构

### 整体架构图

```
App.vue (根组件)
    ↓
AppLayout.vue (主布局)
    ↓
┌─────────────────────────────────────────────┐
│ 搜索区域 (SearchBar) + 筛选区域 (CategoryFilter) │
├─────────────────────────────────────────────┤
│ 网站卡片网格 (WebsiteCard)                   │
├─────────────────────────────────────────────┤
│ 模态框系统 (BaseModal + 各种Modal)           │
└─────────────────────────────────────────────┘
```

### 状态管理架构

```
Pinia Store
├── website.ts (网站数据管理)
├── category.ts (分类管理)
├── tag.ts (标签管理)
├── ui.ts (UI状态管理)
└── settings.ts (应用设置)
```

## 核心功能模块

### 1. 网站管理模块

#### 数据流向

```
用户操作 → AppLayout.vue → useWebsiteStore → localStorage
         ↓
    UI更新 ← computed属性 ← websites.value
```

#### 关键函数

- `addWebsite()` - 添加新网站
- `updateWebsite()` - 更新网站信息
- `deleteWebsite()` - 删除网站
- `incrementVisitCount()` - 访问计数

#### 类型定义

```typescript
interface Website {
  id: string
  name: string
  url: string
  description?: string
  favicon?: string
  categoryId: string
  tagIds: string[]
  isOnline: boolean
  visitCount: number
  lastVisited?: Date
  createdAt: Date
  updatedAt: Date
}
```

### 2. 搜索与筛选模块

#### 搜索逻辑流程

```
用户输入关键词 → searchKeyword.value
         ↓
searchResults computed属性过滤
         ↓
筛选条件应用:
  - 关键词匹配
  - 分类筛选
  - 标签筛选
         ↓
结果展示 (WebsiteCard组件)
```

#### 筛选层级

```
搜索结果展示层
├── 关键词筛选 (最高优先级)
├── 分类筛选
└── 标签筛选 (支持多选)
```

### 3. UI状态管理

#### 模态框管理系统

```
BaseModal (通用容器)
    ↓
具体Modal组件:
├── AddSiteModal (添加/编辑网站)
├── ManageCategoriesModal (分类管理)
├── ManageTagsModal (标签管理)
└── SettingsModal (设置面板)
```

#### Toast通知系统

```
showToast() → toasts.value → ToastContainer → ToastItem → 自动移除
```

### 4. 数据持久化

#### localStorage存储结构

```json
{
  "websites": [...],
  "categories": [...],
  "tags": [...]
}
```

#### 数据同步机制

```
数据变更 → saveToLocalStorage() → localStorage.setItem()
         ↓
页面加载 → initializeData() → localStorage.getItem()
```

## 组件调用关系

### 主要组件链

```
main.ts
    ↓
App.vue
    ↓
AppLayout.vue
    ├─→ SearchBar.vue
    ├─→ CategoryFilter.vue
    ├─→ WebsiteCard.vue (循环)
    ├─→ EmptyState.vue
    ├─→ BaseModal.vue
    │   ├─→ AddSiteModal.vue
    │   ├─→ ManageCategoriesModal.vue
    │   ├─→ ManageTagsModal.vue
    │   └─→ SettingsModal.vue
    └─→ ToastContainer.vue
        └─→ ToastItem.vue (循环)
```

### 组件通信模式

```
父组件 → 子组件: Props
子组件 → 父组件: Emits
全局状态: Pinia Stores
临时状态: provide/inject (较少使用)
```

## 样式系统

### SCSS架构

```
styles/
├── variables.scss    # 设计令牌
├── mixins.scss      # 混合器
├── design-tokens.scss # 设计系统
└── main.scss        # 主样式文件
```

### 设计令牌系统

```scss
// 颜色系统
$color-primary: #3B82F6
$color-secondary: #10B981
$color-neutral-50: #F9FAFB
// ...

// 间距系统
$spacing-xs: 2px
$spacing-sm: 4px
$spacing-md: 8px
// ...

// 字体系统
$font-family-sans: -apple-system, BlinkMacSystemFont, ...
$font-size-xs: 0.75rem
$font-size-sm: 0.875rem
// ...
```

### BEM命名规范

```scss
.website-card                    // Block
.website-card__header           // Element
.website-card__title            // Element
.website-card--featured         // Modifier
.website-card--loading          // Modifier
```

## 工具函数库

### 核心工具函数 (utils/helpers.ts)

```typescript
// ID生成器
export const generateId = (): string

// 格式化工具
export const formatDate = (date: Date): string
export const formatUrl = (url: string): string

// 验证工具
export const isValidUrl = (url: string): boolean
export const isValidEmail = (email: string): boolean
```

## 性能优化策略

### 1. 组件层面优化

- 使用computed属性缓存计算结果
- 懒加载图片 (loading="lazy")
- 虚拟滚动 (未来可实施)

### 2. 状态管理优化

- 避免深度响应式监听
- 合理使用readonly包装
- 批量更新减少响应式触发

### 3. 构建优化

- Vite按需加载
- 代码分割
- 资源压缩

## 错误处理机制

### 1. 全局错误处理

```typescript
// Vue错误处理器
app.config.errorHandler = (error, instance, info) => {
  console.error('Global error:', error, info)
}
```

### 2. 网络错误处理

- 图片加载失败处理
- localStorage访问异常处理
- API请求错误处理 (未来)

### 3. 用户体验优化

- Toast错误提示
- EmptyState空状态展示
- 加载状态指示器

## 类型系统

### 核心类型定义 (types/index.ts)

```typescript
// 实体类型
interface Website { ... }
interface Category { ... }
interface Tag { ... }

// 状态类型
interface ModalState { ... }
interface ToastMessage { ... }
interface SearchFilters { ... }

// 工具类型
type SortField = 'name' | 'createdAt' | 'visitCount'
type SortOrder = 'asc' | 'desc'
type ModalType = 'addSite' | 'manageCategories' | ...
```

## 开发工作流

### 1. 代码质量保证

```bash
# 类型检查
npm run type-check

# 代码检查
npm run lint

# 代码格式化
npm run format
```

### 2. 构建与部署

```bash
# 开发服务器
npm run dev

# 生产构建
npm run build

# 预览构建结果
npm run preview
```

## 未来扩展计划

### 1. 功能扩展

- [ ] 网站图标自动获取
- [ ] 批量导入功能
- [ ] 数据同步云端
- [ ] 网站健康检测
- [ ] 访问统计图表

### 2. 性能优化

- [ ] 虚拟滚动实现
- [ ] 搜索防抖优化
- [ ] 图片懒加载优化
- [ ] Service Worker缓存

### 3. 用户体验

- [ ] 键盘快捷键完善
- [ ] 拖拽排序功能
- [ ] 主题切换功能
- [ ] 多语言支持

---

_文档版本: v1.0_
_最后更新: 2025-11-12_
_维护者: 白岚_
